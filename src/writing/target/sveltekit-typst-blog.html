<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SvelteKit blog with Typst as markup language</title>
    <meta name="description" content="Guide to making a SvelteKit blog with Typst as the markup language.">
    <meta property="article:published_time" content="2025-12-19">
    <meta property="article:tag" content="typst">
    <meta property="article:tag" content="javascript">
    <meta property="article:tag" content="svelte">
  </head>
  <body>
    <p>As of December 2025, Typst’s <a href="https://typst.app/docs/reference/html/">documentation for HTML export</a> states:</p>
    <blockquote>Typst’s HTML export is currently under active development. The feature is still very incomplete and only available for experimentation behind a feature flag. Do not use this feature for production use cases.</blockquote>
    <p>Seems like a great time to create a blog that relies on Typst HTML export!</p>
    <h2>Introduction</h2>
    <p>This article acts as a guide to building a bare-bones blog website with SvelteKit and Typst, based on my experience making the website you’re currently looking at, with support for code blocks, math, footnotes, and other rich content. I focus on getting the website to function, omitting the styling that makes it look nice.</p>
    <p>Because of the experimental nature of Typst’s HTML export, much of this article consists of code that patches unsupported elements into Typst and SvelteKit. If you have a popular blog with billions of important serious users, I probably can’t safely recommend this setup. However, if you really like Typst, really like Svelte, and don’t really mind an unstable setup for your website, this guide is for you.</p>
    <h2>Why</h2>
    <p>Because SvelteKit and Typst are both very good.</p>
    <p><strong>SvelteKit</strong> is built on Svelte, a JavaScript framework that’s extremely simple and focused on developer experience. It also supports static site generation with <code><span style="color: #abb2bf">adapter-static</span></code>, prerendering each page at compile time for blazingly fast loading speeds on any static website hosting service, such as GitHub pages.</p>
    <p><strong>Typst</strong> has beautiful markdown-inspired syntax that makes reading the source almost as easy as reading the output. The biggest reason Typst is better than Markdown for a blog is that it is also a fully-featured programming language, allowing you to run arbitrary code to generate your markup.<sup><a id="footnote-return-1" href="#footnote-1" role="doc-noteref" aria-label="footnote 1">1</a></sup></p>
    <h2>Setup</h2>
    <p>To generate a SvelteKit project named <code><span style="color: #abb2bf">sveltekit-typst-blog</span></code>, open your terminal and run</p>
    <div class="raw">
      <raw-copy-button text="&quot;npx sv create sveltekit-typst-blog&quot;"></raw-copy-button>
      <pre><code data-lang="bash"><span style="color: #eb6772">npx</span><span style="color: #abb2bf"> sv create sveltekit-typst-blog</span></code></pre>
    </div>
    <p>Then, when prompted, choose <code><span style="color: #abb2bf">SvelteKit minimal</span></code> as your template, add TypeScript type checking, and don’t add anything else to your project.<sup><a id="footnote-return-2" href="#footnote-2" role="doc-noteref" aria-label="footnote 2">2</a></sup> Now, run</p>
    <div class="raw">
      <raw-copy-button text="&quot;cd sveltkit-typst-blog\nnpm run dev -- --open&quot;"></raw-copy-button>
      <pre><code data-lang="bash"><span style="color: #5ebfcc">cd</span><span style="color: #abb2bf"> sveltkit-typst-blog</span><br><span style="color: #eb6772">npm</span><span style="color: #abb2bf"> run dev</span><span style="color: #adb7c9"> --</span><span style="color: #abb2bf"> --open</span></code></pre>
    </div>
    <p>You should see your website running in your browser!</p>
    <enhanced-img src="&quot;sveltekit-typst-blog/svelkit-starter.png&quot;" alt="&quot;Screenshot of rendered SvelteKit starter project, with simple 'Welcome to SvelteKit' header.&quot;"></enhanced-img>
    <h2>Strategy</h2>
    <p>I’ll discuss the strategy we’ll use to render Typst in our website. We will</p>
    <ol>
      <li>Write our blog posts in Typst.</li>
      <li>Use the Typst compiler to convert all Typst files into HTML files.</li>
      <li>Parse the HTML files server-side to extract metadata, like the post title and publish date.</li>
      <li>Render the HTML on the frontend with the Svelte <a href="https://svelte.dev/docs/svelte/@html"><code><span style="color: #abb2bf">@html</span></code> template syntax</a>.</li>
    </ol>
    <h2>Posts folder</h2>
    <p>We’ll start by creating a folder to hold our blog posts. Create a folder <code><span style="color: #abb2bf">src/posts</span></code>. Inside this folder, create</p>
    <ol>
      <li>a folder named <code><span style="color: #abb2bf">lib</span></code> with a file <code><span style="color: #abb2bf">lib.typ</span></code>, which we will use to create shared code for all articles</li>
      <li>a folder named <code><span style="color: #abb2bf">target</span></code> which will contain the generated HTML</li>
      <li>a file <code><span style="color: #abb2bf">test.typ</span></code> that we’ll use to test different content types</li>
    </ol>
    <h3><code><span style="color: #abb2bf">lib.typ</span></code> article function</h3>
    <p>In our <code><span style="color: #abb2bf">lib.typ</span></code> file, we’ll create a function called <code><span style="color: #abb2bf">article</span></code> that we’ll wrap all future articles in using show rules:</p>
    <file-display path="&quot;src/posts/lib/lib.typ&quot;"><div class="raw"><raw-copy-button text="&quot;#let article(\n  content,\n  title: \&quot;Article title\&quot;,\n  date: datetime(year: 2025, month: 12, day: 14),\n) = {\n  html.elem(\&quot;html\&quot;)[\n    #html.elem(\&quot;head\&quot;)[\n      #html.elem(\&quot;title\&quot;)[#title]\n      #html.elem(\&quot;meta\&quot;, attrs: (property: \&quot;article:published_time\&quot;, content: date.display()))\n    ]\n    #html.elem(\&quot;body\&quot;)[\n      #content\n    ]\n  ]\n}&quot;"></raw-copy-button><pre><code data-lang="typ"><span style="color: #cd74e8">#</span><span style="color: #cd74e8">let</span> <span style="color: #5cb3fa">article</span>(<br>  content,<br>  title: <span style="color: #9acc76">"Article title"</span>,<br>  date: <span style="color: #5cb3fa">datetime</span>(year: <span style="color: #db9d63">2025</span>, month: <span style="color: #db9d63">12</span>, day: <span style="color: #db9d63">14</span>),<br>) <span style="color: #adb7c9">=</span> {<br>  html.<span style="color: #5cb3fa">elem</span>(<span style="color: #9acc76">"html"</span>)[<br>    #html.<span style="color: #5cb3fa">elem</span>(<span style="color: #9acc76">"head"</span>)[<br>      #html.<span style="color: #5cb3fa">elem</span>(<span style="color: #9acc76">"title"</span>)[#title]<br>      #html.<span style="color: #5cb3fa">elem</span>(<span style="color: #9acc76">"meta"</span>, attrs: (property: <span style="color: #9acc76">"article:published_time"</span>, content: date.<span style="color: #5cb3fa">display</span>()))<br>    ]<br>    #html.<span style="color: #5cb3fa">elem</span>(<span style="color: #9acc76">"body"</span>)[<br>      #content<br>    ]<br>  ]<br>}</code></pre></div></file-display>
    <p>Here, we allow users to specify we use Typst’s HTML <code><span style="color: #abb2bf">elem</span></code> function to generate the basic structure of our document, including metadata in the <code><span style="color: #abb2bf">head</span></code> element.<sup><a id="footnote-return-3" href="#footnote-3" role="doc-noteref" aria-label="footnote 3">3</a></sup></p>
    <h3><code><span style="color: #abb2bf">test.typ</span></code> content types</h3>
    <p>Now, we can use our newly-created <code><span style="color: #abb2bf">article</span></code> function in our test article:</p>
    <file-display path="&quot;src/posts/test.typ&quot;"><div class="raw"><raw-copy-button text="&quot;#import \&quot;lib/lib.typ\&quot;: *\n\n#show: article.with(\n  title: \&quot;Test article\&quot;,\n  date: datetime(year: 2025, month: 12, day: 14),\n)&quot;"></raw-copy-button><pre><code data-lang="typ"><span style="color: #cd74e8">#</span><span style="color: #cd74e8">import</span> <span style="color: #9acc76">"lib/lib.typ"</span>: <span style="color: #adb7c9">*</span><br><br><span style="color: #cd74e8">#</span><span style="color: #cd74e8">show</span>: article.<span style="color: #5cb3fa">with</span>(<br>  title: <span style="color: #9acc76">"Test article"</span>,<br>  date: <span style="color: #5cb3fa">datetime</span>(year: <span style="color: #db9d63">2025</span>, month: <span style="color: #db9d63">12</span>, day: <span style="color: #db9d63">14</span>),<br>)</code></pre></div></file-display>
    <p>We’ll also include examples of different types content we want to support in our blog.</p>
    <collapsible><file-display path="&quot;src/posts/test.typ&quot;"><div class="raw"><raw-copy-button text="&quot;// ...\n= Paragraph\n#lorem(67)\n\n= Marks\n\nMarks:\n\n- *bold text*\n- _italic text_\n- #underline[underline text]\n- `code text`\n- #link(\&quot;https://www.google.com/\&quot;)[link to google]\n\n= Headings\n\n== Heading 2\n\n=== Heading 3\n\n==== Heading 4\n\n===== Heading 5\n\n= Lists\n\n== Unordered\n- unordered list\n  - that goes\n    - like this\n- and also has item\n- hello\n\n== Ordered\n+ ordered list\n+ that goes\n+ like this\n  + and has\n    + nestings\n\n= Code\n\n```python\nimport math\n\ndef code_block(with_syntax_highlight):\nprint(\&quot;hello world\&quot;)\nx = {\&quot;hello\&quot;: (1, 2), \&quot;goodbye\&quot;: (3, 4)}\nreturn f\&quot;hello {1}\&quot;\n```\n\n= Blockquote\n\n#quote(block: true)[\n  Blockquote that is pretty long and contains *rich content*.\n\n  And can be multiline.\n]\n\n= Math\n\nInline math $(1 + 3 + 3^4 / 1) / 2 x y z$ wow that was cool math.\n\nBlock math:\n$\n  cases(1 + 1, hat(2 + 2), 3 + 3/2)\n$&quot;"></raw-copy-button><pre><code data-lang="typ"><em><span style="color: #5f697a">// ...</span></em><br>= Paragraph<br><span style="color: #5cb3fa">#</span><span style="color: #5cb3fa">lorem</span>(<span style="color: #db9d63">67</span>)<br><br>= Marks<br><br>Marks:<br><br>- <span style="color: #f0c678">*</span><span style="color: #f0c678">bold text</span><span style="color: #f0c678">*</span><br>- <span style="color: #cd74e8">_</span><span style="color: #cd74e8">italic text</span><span style="color: #cd74e8">_</span><br>- <span style="color: #5cb3fa">#</span><span style="color: #5cb3fa">underline</span>[underline text]<br>- `code text`<br>- <span style="color: #5cb3fa">#</span><span style="color: #5cb3fa">link</span>(<span style="color: #9acc76">"https://www.google.com/"</span>)[link to google]<br><br>= Headings<br><br>== Heading 2<br><br>=== Heading 3<br><br>==== Heading 4<br><br>===== Heading 5<br><br>= Lists<br><br>== Unordered<br>- unordered list<br>  - that goes<br>    - like this<br>- and also has item<br>- hello<br><br>== Ordered<br>+ ordered list<br>+ that goes<br>+ like this<br>  + and has<br>    + nestings<br><br>= Code<br><br>```python<br>import math<br><br>def code_block(with_syntax_highlight):<br>print("hello world")<br>x = {"hello": (1, 2), "goodbye": (3, 4)}<br>return f"hello {1}"<br>```<br><br>= Blockquote<br><br><span style="color: #5cb3fa">#</span><span style="color: #5cb3fa">quote</span>(block: <span style="color: #cd74e8">true</span>)[<br>  Blockquote that is pretty long and contains <span style="color: #f0c678">*</span><span style="color: #f0c678">rich content</span><span style="color: #f0c678">*</span>.<br><br>  And can be multiline.<br>]<br><br>= Math<br><br>Inline math $(1 + 3 + 3<span style="color: #adb7c9">^</span>4 <span style="color: #adb7c9">/</span> 1) <span style="color: #adb7c9">/</span> 2 x y z$ wow that was cool math.<br><br>Block math:<br>$<br>  <span style="color: #5cb3fa">cases</span>(1 + 1, <span style="color: #5cb3fa">hat</span>(2 + 2), 3 + 3<span style="color: #adb7c9">/</span>2)<br>$</code></pre></div></file-display></collapsible>
    <h3>Compile to HTML</h3>
    <p>Now, we can compile our file to HTML! Install the <a href="https://typst.app/open-source/">Typst compiler</a> if you haven’t already, then open your terminal and run</p>
    <div class="raw">
      <raw-copy-button text="&quot;typst compile src/posts/test.typ src/posts/target/test.html --format html --features html&quot;"></raw-copy-button>
      <pre><code data-lang="bash"><span style="color: #eb6772">typst</span><span style="color: #abb2bf"> compile src/posts/test.typ src/posts/target/test.html</span><span style="color: #eb6772"> --</span><span style="color: #eb6772">format</span><span style="color: #abb2bf"> html</span><span style="color: #eb6772"> --</span><span style="color: #eb6772">features</span><span style="color: #abb2bf"> html</span></code></pre>
    </div>
    <p>You should see a newly created <code><span style="color: #abb2bf">test.html</span></code> in <code><span style="color: #abb2bf">src/posts/target/test.html</span></code>! Ignore any warnings you get for now, we will fix them later.</p>
    <h2>Post rendering</h2>
    <p>Now, let’s display our posts in SvelteKit!</p>
    <h3>Extraction functions</h3>
    <p>First, we’ll create some utility functions to extract the metadata and content out of our generated HTML files. To parse our HTML on the server, which doesn’t have access to the browser’s DOM API, we need to install <a href="https://github.com/WebReflection/linkedom">linkedom</a>. To do that, run</p>
    <div class="raw">
      <raw-copy-button text="&quot;npm i linkedom&quot;"></raw-copy-button>
      <pre><code data-lang="bash"><span style="color: #eb6772">npm</span><span style="color: #abb2bf"> i linkedom</span></code></pre>
    </div>
    <p>Now, create a new file <code><span style="color: #abb2bf">posts.ts</span></code> in <code><span style="color: #abb2bf">src/lib</span></code> for our extraction functions. We’ll first create a <code><span style="color: #abb2bf">PostMeta</span></code> type to group each post’s metadata:</p>
    <file-display path="&quot;src/lib/posts.ts&quot;"><div class="raw"><raw-copy-button text="&quot;export type PostMeta = {\n  title: string;\n  date: string;\n};&quot;"></raw-copy-button><pre><code data-lang="ts"><span style="color: #cd74e8">export</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">type</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">PostMeta</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">  </span><span style="color: #eb6772">title</span><span style="color: #adb7c9">:</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">string</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">  </span><span style="color: #eb6772">date</span><span style="color: #adb7c9">:</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">string</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">}</span><span style="color: #abb2bf">;</span></code></pre></div></file-display>
    <p>Then, we’ll create a function to extract that metadata, using the <code><span style="color: #abb2bf">parseHTML</span></code> function from <code><span style="color: #abb2bf">linkedom</span></code>.</p>
    <file-display path="&quot;src/lib/posts.ts&quot;"><div class="raw"><raw-copy-button text="&quot;export function extractMeta(html: string): PostMeta {\n  const { document } = parseHTML(html);\n\n  const title = document.title ?? \&quot;no title\&quot;;\n\n  const dateMeta = document.querySelector(\n    'meta[property=\&quot;article:published_time\&quot;]'\n  );\n  const date = dateMeta?.getAttribute(\&quot;content\&quot;) ?? \&quot;2000-1-1\&quot;;\n\n  return {\n    title,\n    date,\n  };\n}&quot;"></raw-copy-button><pre><code data-lang="ts"><span style="color: #cd74e8">export</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">function</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">extractMeta</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">html</span><span style="color: #adb7c9">:</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">string</span><span style="color: #abb2bf">)</span><span style="color: #adb7c9">:</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">PostMeta</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">document</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">parseHTML</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">html</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">title</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">document</span><span style="color: #abb2bf">.</span><span style="color: #abb2bf">title</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">??</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">no title</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">;</span><br><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">dateMeta</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">document</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">querySelector</span><span style="color: #abb2bf">(</span><br><span style="color: #abb2bf">    </span><span style="color: #9acc76">'</span><span style="color: #9acc76">meta[property="article:published_time"]</span><span style="color: #9acc76">'</span><br><span style="color: #abb2bf">  </span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">date</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">dateMeta</span><span style="color: #abb2bf">?.</span><span style="color: #5ebfcc">getAttribute</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">"</span><span style="color: #9acc76">content</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">??</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">2000-1-1</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">;</span><br><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">return</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">    </span><span style="color: #eb6772">title</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">    </span><span style="color: #eb6772">date</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">  </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">}</span></code></pre></div></file-display>
    <p>Finally, we’ll create a symmetrical function to extract the article’s content.</p>
    <file-display path="&quot;src/lib/posts.ts&quot;"><div class="raw"><raw-copy-button text="&quot;export function extractContent(html: string): string {\n  const { document } = parseHTML(html);\n  return document.body.innerHTML;\n}&quot;"></raw-copy-button><pre><code data-lang="ts"><span style="color: #cd74e8">export</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">function</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">extractContent</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">html</span><span style="color: #adb7c9">:</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">string</span><span style="color: #abb2bf">)</span><span style="color: #adb7c9">:</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">string</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">document</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">parseHTML</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">html</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">return</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">document</span><span style="color: #abb2bf">.</span><span style="color: #abb2bf">body</span><span style="color: #abb2bf">.</span><span style="color: #eb6772">innerHTML</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">}</span></code></pre></div></file-display>
    <h3>Post listing</h3>
    <p>We’ll make the website’s homepage display a list of links to all blog posts. In <code><span style="color: #abb2bf">src/routes</span></code>, create a new file <code><span style="color: #abb2bf">+page.server.ts</span></code>. This file will load all HTML files in our target directory and extract the metadata from each one.</p>
    <file-display path="&quot;src/routes/+page.server.ts&quot;"><div class="raw"><raw-copy-button text="&quot;import { extractMeta } from \&quot;$lib/posts\&quot;;\n\nexport async function load() {\n  const allPostFiles = import.meta.glob(\&quot;/src/posts/target/*.html\&quot;, {\n    query: \&quot;?raw\&quot;,\n    import: \&quot;default\&quot;,\n  });\n  const posts = await Promise.all(\n    Object.entries(allPostFiles).map(async ([path, resolver]) => {\n      const html = (await resolver()) as string;\n\n      const slug = path.split(\&quot;/\&quot;).pop()?.replace(\&quot;.html\&quot;, \&quot;\&quot;) ?? \&quot;unknown\&quot;;\n\n      return {\n        meta: extractMeta(html),\n        path: slug,\n      };\n    })\n  );\n\n  return { posts };\n}&quot;"></raw-copy-button><pre><code data-lang="ts"><span style="color: #cd74e8">import</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">extractMeta</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">from</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">$lib/posts</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">;</span><br><br><span style="color: #cd74e8">export</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">async</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">function</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">load</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">allPostFiles</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">import</span><span style="color: #abb2bf">.</span><span style="color: #abb2bf">meta</span><span style="color: #abb2bf">.</span><span style="color: #5cb3fa">glob</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">"</span><span style="color: #9acc76">/src/posts/target/*.html</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">query</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">?raw</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">import</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">default</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">  </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">posts</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">await</span><span style="color: #abb2bf"> </span><span style="color: #f0c678">Promise</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">all</span><span style="color: #abb2bf">(</span><br><span style="color: #abb2bf">    </span><span style="color: #f0c678">Object</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">entries</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">allPostFiles</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">.</span><span style="color: #5cb3fa">map</span><span style="color: #abb2bf">(</span><span style="color: #cd74e8">async</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">[</span><span style="color: #eb6772">path</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">resolver</span><span style="color: #abb2bf">]</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">=></span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">      </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">html</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">(</span><span style="color: #cd74e8">await</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">resolver</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">as</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">string</span><span style="color: #abb2bf">;</span><br><br><span style="color: #abb2bf">      </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">slug</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">path</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">split</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">"</span><span style="color: #9acc76">/</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">pop</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">?.</span><span style="color: #5ebfcc">replace</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">"</span><span style="color: #9acc76">.html</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">??</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">unknown</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">;</span><br><br><span style="color: #abb2bf">      </span><span style="color: #cd74e8">return</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">        </span><span style="color: #abb2bf">meta</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">extractMeta</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">html</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">        </span><span style="color: #abb2bf">path</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">slug</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">      </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf">)</span><br><span style="color: #abb2bf">  </span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">return</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">posts</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">}</span></code></pre></div></file-display>
    <p>Then, we’ll edit the existing <code><span style="color: #abb2bf">src/routes/+page.svelte</span></code> to display a list of links to all posts.</p>
    <file-display path="&quot;src/routes/+page.svelte&quot;"><div class="raw"><raw-copy-button text="&quot;<script lang=\&quot;ts\&quot;>\n  let { data } = $props();\n</script>\n\n<h1>Posts</h1>\n<ul>\n  {#each data.posts as post}\n    <li>\n      <a href=\&quot;./{post.path}\&quot;>\n        {post.meta.title} - {post.meta.date}\n      </a>\n    </li>\n  {/each}\n</ul>&quot;"></raw-copy-button><pre><code data-lang="svelte"><span style="color: #abb2bf">&lt;</span><span style="color: #eb6772">script</span><span style="color: #abb2bf"> </span><span style="color: #db9d63">lang</span><span style="color: #abb2bf">=</span><span style="color: #9acc76">"</span><span style="color: #9acc76">ts</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">></span><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">let</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">data</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">$props</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">&lt;/</span><span style="color: #eb6772">script</span><span style="color: #abb2bf">></span><br><br><span style="color: #abb2bf">&lt;</span><span style="color: #eb6772">h1</span><span style="color: #abb2bf">></span><span style="color: #abb2bf">Posts</span><span style="color: #abb2bf">&lt;/</span><span style="color: #eb6772">h1</span><span style="color: #abb2bf">></span><br><span style="color: #abb2bf">&lt;</span><span style="color: #eb6772">ul</span><span style="color: #abb2bf">></span><br><span style="color: #abb2bf">  </span><span style="color: #c94e42">{</span><span style="color: #cd74e8">#each</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">data</span><span style="color: #abb2bf">.</span><span style="color: #eb6772">posts</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">as</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">post</span><span style="color: #c94e42">}</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">&lt;</span><span style="color: #eb6772">li</span><span style="color: #abb2bf">></span><br><span style="color: #abb2bf">      </span><span style="color: #abb2bf">&lt;</span><span style="color: #eb6772">a</span><span style="color: #abb2bf"> </span><span style="color: #db9d63">href</span><span style="color: #abb2bf">=</span><span style="color: #9acc76">"</span><span style="color: #9acc76">./</span><span style="color: #c94e42">{</span><span style="color: #adb7c9">post</span><span style="color: #abb2bf">.</span><span style="color: #abb2bf">path</span><span style="color: #c94e42">}</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">></span><br><span style="color: #abb2bf">        </span><span style="color: #c94e42">{</span><span style="color: #adb7c9">post</span><span style="color: #abb2bf">.</span><span style="color: #abb2bf">meta</span><span style="color: #abb2bf">.</span><span style="color: #abb2bf">title</span><span style="color: #c94e42">}</span><span style="color: #abb2bf"> - </span><span style="color: #c94e42">{</span><span style="color: #adb7c9">post</span><span style="color: #abb2bf">.</span><span style="color: #abb2bf">meta</span><span style="color: #abb2bf">.</span><span style="color: #abb2bf">date</span><span style="color: #c94e42">}</span><br><span style="color: #abb2bf">      </span><span style="color: #abb2bf">&lt;/</span><span style="color: #eb6772">a</span><span style="color: #abb2bf">></span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">&lt;/</span><span style="color: #eb6772">li</span><span style="color: #abb2bf">></span><br><span style="color: #abb2bf">  </span><span style="color: #c94e42">{</span><span style="color: #cd74e8">/each</span><span style="color: #c94e42">}</span><br><span style="color: #abb2bf">&lt;/</span><span style="color: #eb6772">ul</span><span style="color: #abb2bf">></span></code></pre></div></file-display>
    <h3>Post display</h3>
    <p>In <code><span style="color: #abb2bf">src/routes</span></code>, create a folder called <code><span style="color: #abb2bf">[slug]</span></code>. Inside that folder, first create a file <code><span style="color: #abb2bf">+page.server.ts</span></code>. This file will get our HTML file, extract the metadata, and send both the metadata and the article contents to the frontend.</p>
    <p>We’ll define a function called <code><span style="color: #abb2bf">load</span></code>, whose return value SvelteKit will automatically pass to the frontend.</p>
    <file-display path="&quot;src/routes/[slug]/+page.server.ts&quot;"><div class="raw"><raw-copy-button text="&quot;import { extractContent, extractMeta } from \&quot;$lib/posts\&quot;;\nimport { error } from \&quot;@sveltejs/kit\&quot;;\n\nexport async function load({ params }) {\n  const slug = params.slug;\n\n  const module = await import(`../../posts/target/${slug}.html?raw`);\n  const html = module.default;\n\n  if (!html) {\n    throw error(404, \&quot;Post not found\&quot;);\n  }\n\n  return {\n    content: extractContent(html),\n    meta: extractMeta(html),\n  };\n}&quot;"></raw-copy-button><pre><code data-lang="ts"><span style="color: #cd74e8">import</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">extractContent</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">extractMeta</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">from</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">$lib/posts</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">;</span><br><span style="color: #cd74e8">import</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">error</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">from</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">@sveltejs/kit</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">;</span><br><br><span style="color: #cd74e8">export</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">async</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">function</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">load</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">{</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">params</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">slug</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">params</span><span style="color: #abb2bf">.</span><span style="color: #eb6772">slug</span><span style="color: #abb2bf">;</span><br><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">module</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">await</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">import</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">`</span><span style="color: #9acc76">../../posts/target/</span><span style="color: #9acc76">${</span><span style="color: #eb6772">slug</span><span style="color: #9acc76">}</span><span style="color: #9acc76">.html?raw</span><span style="color: #9acc76">`</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">html</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">module</span><span style="color: #abb2bf">.</span><span style="color: #eb6772">default</span><span style="color: #abb2bf">;</span><br><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">if</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">(</span><span style="color: #adb7c9">!</span><span style="color: #eb6772">html</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">    </span><span style="color: #cd74e8">throw</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">error</span><span style="color: #abb2bf">(</span><span style="color: #db9d63">404</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">Post not found</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">  </span><span style="color: #abb2bf">}</span><br><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">return</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">content</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">extractContent</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">html</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">meta</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">extractMeta</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">html</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">  </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">}</span></code></pre></div></file-display>
    <p>Here, we first load the HTML by <code><span style="color: #abb2bf">import</span></code>ing it from the target directory based on the URL’s slug (the slug is the part after the last <code><span style="color: #abb2bf">/</span></code> in the URL, which should match the name of our file, see the <a href="https://svelte.dev/docs/kit/routing">SvelteKit routing docs</a> for more information). Then, we use our extraction functions to return the post’s content and metadata.</p>
    <p>With all the data we need extracted, rendering it becomes quite easy. Create another file <code><span style="color: #abb2bf">+page.svelte</span></code> in our <code><span style="color: #abb2bf">[slug]</span></code> folder. In that file, we’ll write some simple rendering code:</p>
    <file-display path="&quot;src/routes/[slug]/+page.svelte&quot;"><div class="raw"><raw-copy-button text="&quot;<script lang=\&quot;ts\&quot;>\n  let { data } = $props();\n</script>\n\n<h1>Title: {data.meta.title}</h1>\n<p>Published on {data.meta.date}</p>\n<article>\n  {@html data.content}\n</article>&quot;"></raw-copy-button><pre><code data-lang="svelte"><span style="color: #abb2bf">&lt;</span><span style="color: #eb6772">script</span><span style="color: #abb2bf"> </span><span style="color: #db9d63">lang</span><span style="color: #abb2bf">=</span><span style="color: #9acc76">"</span><span style="color: #9acc76">ts</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">></span><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">let</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">data</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">$props</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">&lt;/</span><span style="color: #eb6772">script</span><span style="color: #abb2bf">></span><br><br><span style="color: #abb2bf">&lt;</span><span style="color: #eb6772">h1</span><span style="color: #abb2bf">></span><span style="color: #abb2bf">Title: </span><span style="color: #c94e42">{</span><span style="color: #adb7c9">data</span><span style="color: #abb2bf">.</span><span style="color: #abb2bf">meta</span><span style="color: #abb2bf">.</span><span style="color: #abb2bf">title</span><span style="color: #c94e42">}</span><span style="color: #abb2bf">&lt;/</span><span style="color: #eb6772">h1</span><span style="color: #abb2bf">></span><br><span style="color: #abb2bf">&lt;</span><span style="color: #eb6772">p</span><span style="color: #abb2bf">></span><span style="color: #abb2bf">Published on </span><span style="color: #c94e42">{</span><span style="color: #adb7c9">data</span><span style="color: #abb2bf">.</span><span style="color: #abb2bf">meta</span><span style="color: #abb2bf">.</span><span style="color: #abb2bf">date</span><span style="color: #c94e42">}</span><span style="color: #abb2bf">&lt;/</span><span style="color: #eb6772">p</span><span style="color: #abb2bf">></span><br><span style="color: #abb2bf">&lt;</span><span style="color: #eb6772">article</span><span style="color: #abb2bf">></span><br><span style="color: #abb2bf">  </span><span style="color: #c94e42">{@html</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">data</span><span style="color: #abb2bf">.</span><span style="color: #abb2bf">content</span><span style="color: #c94e42">}</span><br><span style="color: #abb2bf">&lt;/</span><span style="color: #eb6772">article</span><span style="color: #abb2bf">></span></code></pre></div></file-display>
    <p>Now, all the pieces are in place! Run <code><span style="color: #abb2bf">npm run dev</span></code>, and go to <code><span style="color: #abb2bf">localhost:????/test</span></code> to view the rendered <code><span style="color: #abb2bf">test.typ</span></code> blog post!</p>
    <enhanced-img src="&quot;sveltekit-typst-blog/first-post-render.png&quot;" alt="&quot;Screenshot of rendered blog post, with the title and date displayed at the top, followed by sample headings, paragraphs, and lists.&quot;"></enhanced-img>
    <h2>Developer experience</h2>
    <p>Although the current setup works, the developer experience is not good. Currently, to see changes in your blog post, you have to manually rerun <code><span style="color: #abb2bf">typst compile</span></code> and reload the website. We’ll fix this by automatically recompiling Typst files when they change, and automatically reloading the website when the source HTML files change in <code><span style="color: #abb2bf">dev</span></code> mode.</p>
    <h3>File watcher</h3>
    <p>First, to install the libraries we need for our file watcher, run</p>
    <div class="raw">
      <raw-copy-button text="&quot;npm install --save @types/node\nnpm i -D chokidar\nnpm i -D concurrently&quot;"></raw-copy-button>
      <pre><code data-lang="bash"><span style="color: #eb6772">npm</span><span style="color: #abb2bf"> install</span><span style="color: #eb6772"> --</span><span style="color: #eb6772">save</span><span style="color: #abb2bf"> @types/node</span><br><span style="color: #eb6772">npm</span><span style="color: #abb2bf"> i</span><span style="color: #eb6772"> -</span><span style="color: #eb6772">D</span><span style="color: #abb2bf"> chokidar</span><br><span style="color: #eb6772">npm</span><span style="color: #abb2bf"> i</span><span style="color: #eb6772"> -</span><span style="color: #eb6772">D</span><span style="color: #abb2bf"> concurrently</span></code></pre>
    </div>
    <p>Then, create a new file <code><span style="color: #abb2bf">scripts/typst-manager.ts</span></code>. This script has two modes, <code><span style="color: #abb2bf">dev</span></code> and <code><span style="color: #abb2bf">build</span></code>, corresponding to <code><span style="color: #abb2bf">vite dev</span></code> and <code><span style="color: #abb2bf">vite build</span></code>.</p>
    <ul>
      <li>in <code><span style="color: #abb2bf">build</span></code> mode, it just runs <code><span style="color: #abb2bf">typst compile</span></code> for all <code><span style="color: #abb2bf">.typ</span></code> files in <code><span style="color: #abb2bf">src/posts</span></code></li>
      <li>
        <p>in <code><span style="color: #abb2bf">dev</span></code> mode, it builds all <code><span style="color: #abb2bf">.typ</span></code> files <em>and</em> checks for updates to <code><span style="color: #abb2bf">.typ</span></code> files</p>
        <ul>
          <li>if a <code><span style="color: #abb2bf">.typ</span></code> file is modified, then the script runs <code><span style="color: #abb2bf">typst watch</span></code> for that file, which will instantly update the HTML whenever the Typst content changes. The approach prevents spawning hundreds of <code><span style="color: #abb2bf">typst watch</span></code> processes if you have hundreds of <code><span style="color: #abb2bf">.typ</span></code> files (assuming that you will likely only edit one blog post at a time).</li>
        </ul>
      </li>
    </ul>
    <p>I won’t go into much more detail about the script. Here’s the code:</p>
    <collapsible><file-display path="&quot;scripts/typst-manager.ts&quot;"><div class="raw"><raw-copy-button text="&quot;import { spawn, execSync } from \&quot;node:child_process\&quot;;\nimport fs from \&quot;node:fs\&quot;;\nimport path from \&quot;node:path\&quot;;\nimport chokidar from \&quot;chokidar\&quot;;\n\nconst ROOT = process.cwd();\nconst SOURCE_DIR = \&quot;src/posts\&quot;;\nconst TARGET_DIR = \&quot;src/posts/target\&quot;;\nconst EXCLUDE = [\&quot;lib.typ\&quot;];\nconst ABS_TARGET = path.resolve(ROOT, TARGET_DIR);\n\nif (!fs.existsSync(path.join(ROOT, TARGET_DIR))) {\n  fs.mkdirSync(path.join(ROOT, TARGET_DIR), { recursive: true });\n}\n\nconst activeWatchers = new Map();\n\nconst mode = process.argv[2] || \&quot;build\&quot;;\n\nif (mode === \&quot;build\&quot;) {\n  buildAll();\n} else if (mode === \&quot;dev\&quot;) {\n  buildAll();\n  startDevMode();\n}\n\nfunction getTypstFiles() {\n  const dir = path.join(ROOT, SOURCE_DIR);\n  return fs\n    .readdirSync(dir)\n    .filter((f) => f.endsWith(\&quot;.typ\&quot;) &amp;&amp; !EXCLUDE.includes(f));\n}\n\nfunction compileFile(fileName: string) {\n  const source = path.join(SOURCE_DIR, fileName);\n  const target = path.join(TARGET_DIR, fileName.replace(\&quot;.typ\&quot;, \&quot;.html\&quot;));\n\n  try {\n    execSync(\n      `typst compile \&quot;${source}\&quot; \&quot;${target}\&quot; --format html --features html`,\n      { stdio: \&quot;inherit\&quot; }\n    );\n    console.log(`built ${fileName}`);\n  } catch (e) {\n    console.error(`failed to build ${fileName}`);\n  }\n}\n\nfunction buildAll() {\n  console.log(\&quot;\\nstarting full typst build...\&quot;);\n  const files = getTypstFiles();\n  files.forEach(compileFile);\n  console.log(\&quot;build complete.\\n\&quot;);\n}\n\nfunction startDevMode() {\n  console.log(\&quot;watching for changes...\&quot;);\n\n  const watcher = chokidar.watch(SOURCE_DIR, {\n    persistent: true,\n    ignoreInitial: true,\n    ignored: [ABS_TARGET],\n  });\n\n  watcher.on(\&quot;all\&quot;, (event, filePath) => {\n    const fileName = path.basename(filePath);\n    const ext = path.extname(filePath).toLowerCase();\n\n    if (!filePath.endsWith(\&quot;.typ\&quot;) || EXCLUDE.includes(fileName)) {\n      return;\n    }\n\n    if (activeWatchers.has(fileName)) {\n      return;\n    }\n\n    if (event === \&quot;change\&quot; || event === \&quot;add\&quot;) {\n      spawnDedicatedWatcher(fileName);\n    }\n  });\n\n  process.on(\&quot;SIGINT\&quot;, () => {\n    console.log(\&quot;\\nstopping all typst watchers...\&quot;);\n    activeWatchers.forEach((child, name) => {\n      child.kill();\n    });\n    process.exit();\n  });\n}\n\nfunction spawnDedicatedWatcher(fileName: string) {\n  console.log(`spawning dedicated watcher for: ${fileName}`);\n\n  const source = path.join(SOURCE_DIR, fileName);\n  const target = path.join(TARGET_DIR, fileName.replace(\&quot;.typ\&quot;, \&quot;.html\&quot;));\n\n  const child = spawn(\n    \&quot;typst\&quot;,\n    [\&quot;watch\&quot;, source, target, \&quot;--format\&quot;, \&quot;html\&quot;, \&quot;--features\&quot;, \&quot;html\&quot;],\n    {\n      stdio: \&quot;inherit\&quot;,\n      shell: true,\n    }\n  );\n\n  activeWatchers.set(fileName, child);\n\n  child.on(\&quot;close\&quot;, () => {\n    activeWatchers.delete(fileName);\n  });\n}&quot;"></raw-copy-button><pre><code data-lang="ts"><span style="color: #cd74e8">import</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">spawn</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">execSync</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">from</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">node:child_process</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">;</span><br><span style="color: #cd74e8">import</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">fs</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">from</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">node:fs</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">;</span><br><span style="color: #cd74e8">import</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">path</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">from</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">node:path</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">;</span><br><span style="color: #cd74e8">import</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">chokidar</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">from</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">chokidar</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">;</span><br><br><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">ROOT</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">process</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">cwd</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">SOURCE_DIR</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">src/posts</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">;</span><br><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">TARGET_DIR</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">src/posts/target</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">;</span><br><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">EXCLUDE</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">[</span><span style="color: #9acc76">"</span><span style="color: #9acc76">lib.typ</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">]</span><span style="color: #abb2bf">;</span><br><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">ABS_TARGET</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">path</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">resolve</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">ROOT</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">TARGET_DIR</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><br><span style="color: #cd74e8">if</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">(</span><span style="color: #adb7c9">!</span><span style="color: #eb6772">fs</span><span style="color: #abb2bf">.</span><span style="color: #5cb3fa">existsSync</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">path</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">join</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">ROOT</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">TARGET_DIR</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">  </span><span style="color: #eb6772">fs</span><span style="color: #abb2bf">.</span><span style="color: #5cb3fa">mkdirSync</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">path</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">join</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">ROOT</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">TARGET_DIR</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">recursive</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #db9d63">true</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">}</span><br><br><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">activeWatchers</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">new</span><span style="color: #abb2bf"> </span><span style="color: #f0c678">Map</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><br><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">mode</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">process</span><span style="color: #abb2bf">.</span><span style="color: #abb2bf">argv</span><span style="color: #abb2bf">[</span><span style="color: #db9d63">2</span><span style="color: #abb2bf">]</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">||</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">build</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">;</span><br><br><span style="color: #cd74e8">if</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">(</span><span style="color: #eb6772">mode</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">===</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">build</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">  </span><span style="color: #5cb3fa">buildAll</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">}</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">else</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">if</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">(</span><span style="color: #eb6772">mode</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">===</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">dev</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">  </span><span style="color: #5cb3fa">buildAll</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">  </span><span style="color: #5cb3fa">startDevMode</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">}</span><br><br><span style="color: #cd74e8">function</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">getTypstFiles</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">dir</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">path</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">join</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">ROOT</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">SOURCE_DIR</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">return</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">fs</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">.</span><span style="color: #5cb3fa">readdirSync</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">dir</span><span style="color: #abb2bf">)</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">.</span><span style="color: #5cb3fa">filter</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">f</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">=></span><span style="color: #abb2bf"> </span><span style="color: #eb6772">f</span><span style="color: #abb2bf">.</span><span style="color: #5cb3fa">endsWith</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">"</span><span style="color: #9acc76">.typ</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">&amp;&amp;</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">!</span><span style="color: #eb6772">EXCLUDE</span><span style="color: #abb2bf">.</span><span style="color: #5cb3fa">includes</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">f</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">}</span><br><br><span style="color: #cd74e8">function</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">compileFile</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">fileName</span><span style="color: #adb7c9">:</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">string</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">source</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">path</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">join</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">SOURCE_DIR</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">fileName</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">target</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">path</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">join</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">TARGET_DIR</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">fileName</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">replace</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">"</span><span style="color: #9acc76">.typ</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">.html</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">try</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">    </span><span style="color: #5cb3fa">execSync</span><span style="color: #abb2bf">(</span><br><span style="color: #abb2bf">      </span><span style="color: #9acc76">`</span><span style="color: #9acc76">typst compile "</span><span style="color: #9acc76">${</span><span style="color: #eb6772">source</span><span style="color: #9acc76">}</span><span style="color: #9acc76">" "</span><span style="color: #9acc76">${</span><span style="color: #eb6772">target</span><span style="color: #9acc76">}</span><span style="color: #9acc76">" --format html --features html</span><span style="color: #9acc76">`</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">      </span><span style="color: #abb2bf">{</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">stdio</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">inherit</span><span style="color: #9acc76">"</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">}</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">    </span><span style="color: #f0c678">console</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">log</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">`</span><span style="color: #9acc76">built </span><span style="color: #9acc76">${</span><span style="color: #eb6772">fileName</span><span style="color: #9acc76">}</span><span style="color: #9acc76">`</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">  </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">catch</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">(</span><span style="color: #eb6772">e</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">    </span><span style="color: #f0c678">console</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">error</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">`</span><span style="color: #9acc76">failed to build </span><span style="color: #9acc76">${</span><span style="color: #eb6772">fileName</span><span style="color: #9acc76">}</span><span style="color: #9acc76">`</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">  </span><span style="color: #abb2bf">}</span><br><span style="color: #abb2bf">}</span><br><br><span style="color: #cd74e8">function</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">buildAll</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">  </span><span style="color: #f0c678">console</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">log</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">"</span><span style="color: #5ebfcc">\n</span><span style="color: #9acc76">starting full typst build...</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">files</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">getTypstFiles</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">  </span><span style="color: #eb6772">files</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">forEach</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">compileFile</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">  </span><span style="color: #f0c678">console</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">log</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">"</span><span style="color: #9acc76">build complete.</span><span style="color: #5ebfcc">\n</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">}</span><br><br><span style="color: #cd74e8">function</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">startDevMode</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">  </span><span style="color: #f0c678">console</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">log</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">"</span><span style="color: #9acc76">watching for changes...</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">watcher</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">chokidar</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">watch</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">SOURCE_DIR</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">persistent</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #db9d63">true</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">ignoreInitial</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #db9d63">true</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">ignored</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">[</span><span style="color: #eb6772">ABS_TARGET</span><span style="color: #abb2bf">]</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">  </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><br><span style="color: #abb2bf">  </span><span style="color: #eb6772">watcher</span><span style="color: #abb2bf">.</span><span style="color: #5cb3fa">on</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">"</span><span style="color: #9acc76">all</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">(</span><span style="color: #eb6772">event</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">filePath</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">=></span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">    </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">fileName</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">path</span><span style="color: #abb2bf">.</span><span style="color: #5cb3fa">basename</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">filePath</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">    </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">ext</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">path</span><span style="color: #abb2bf">.</span><span style="color: #5cb3fa">extname</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">filePath</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">toLowerCase</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><br><span style="color: #abb2bf">    </span><span style="color: #cd74e8">if</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">(</span><span style="color: #adb7c9">!</span><span style="color: #eb6772">filePath</span><span style="color: #abb2bf">.</span><span style="color: #5cb3fa">endsWith</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">"</span><span style="color: #9acc76">.typ</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">||</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">EXCLUDE</span><span style="color: #abb2bf">.</span><span style="color: #5cb3fa">includes</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">fileName</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">      </span><span style="color: #cd74e8">return</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">}</span><br><br><span style="color: #abb2bf">    </span><span style="color: #cd74e8">if</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">(</span><span style="color: #eb6772">activeWatchers</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">has</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">fileName</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">      </span><span style="color: #cd74e8">return</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">}</span><br><br><span style="color: #abb2bf">    </span><span style="color: #cd74e8">if</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">event</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">===</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">change</span><span style="color: #9acc76">"</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">||</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">event</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">===</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">add</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">      </span><span style="color: #5cb3fa">spawnDedicatedWatcher</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">fileName</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">}</span><br><span style="color: #abb2bf">  </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><br><span style="color: #abb2bf">  </span><span style="color: #abb2bf">process</span><span style="color: #abb2bf">.</span><span style="color: #5cb3fa">on</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">"</span><span style="color: #9acc76">SIGINT</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">=></span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">    </span><span style="color: #f0c678">console</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">log</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">"</span><span style="color: #5ebfcc">\n</span><span style="color: #9acc76">stopping all typst watchers...</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">    </span><span style="color: #eb6772">activeWatchers</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">forEach</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">child</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">name</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">=></span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">      </span><span style="color: #eb6772">child</span><span style="color: #abb2bf">.</span><span style="color: #5cb3fa">kill</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">process</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">exit</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">  </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">}</span><br><br><span style="color: #cd74e8">function</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">spawnDedicatedWatcher</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">fileName</span><span style="color: #adb7c9">:</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">string</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">  </span><span style="color: #f0c678">console</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">log</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">`</span><span style="color: #9acc76">spawning dedicated watcher for: </span><span style="color: #9acc76">${</span><span style="color: #eb6772">fileName</span><span style="color: #9acc76">}</span><span style="color: #9acc76">`</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">source</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">path</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">join</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">SOURCE_DIR</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">fileName</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">target</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">path</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">join</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">TARGET_DIR</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">fileName</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">replace</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">"</span><span style="color: #9acc76">.typ</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">.html</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><br><span style="color: #abb2bf">  </span><span style="color: #cd74e8">const</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">child</span><span style="color: #abb2bf"> </span><span style="color: #adb7c9">=</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">spawn</span><span style="color: #abb2bf">(</span><br><span style="color: #abb2bf">    </span><span style="color: #9acc76">"</span><span style="color: #9acc76">typst</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">[</span><span style="color: #9acc76">"</span><span style="color: #9acc76">watch</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">source</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">target</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">--format</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">html</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">--features</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">html</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">]</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">      </span><span style="color: #abb2bf">stdio</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">inherit</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">      </span><span style="color: #abb2bf">shell</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #db9d63">true</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">}</span><br><span style="color: #abb2bf">  </span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><br><span style="color: #abb2bf">  </span><span style="color: #eb6772">activeWatchers</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">set</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">fileName</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">child</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><br><span style="color: #abb2bf">  </span><span style="color: #eb6772">child</span><span style="color: #abb2bf">.</span><span style="color: #5cb3fa">on</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">"</span><span style="color: #9acc76">close</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">=></span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">    </span><span style="color: #eb6772">activeWatchers</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">delete</span><span style="color: #abb2bf">(</span><span style="color: #eb6772">fileName</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">  </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">}</span></code></pre></div></file-display></collapsible>
    <p>Now, we’ll modify our <code><span style="color: #abb2bf">package.json</span></code> to run <code><span style="color: #abb2bf">typst-manager.ts</span></code> whenever we run <code><span style="color: #abb2bf">dev</span></code> or <code><span style="color: #abb2bf">build</span></code>. Modify <code><span style="color: #abb2bf">package.json</span></code> so the <code><span style="color: #abb2bf">scripts</span></code> section looks like this:</p>
    <file-display path="&quot;package.json&quot;"><div class="raw"><raw-copy-button text="&quot;{\n  ...\n  \&quot;scripts\&quot;: {\n    \&quot;typst:dev\&quot;: \&quot;node scripts/typst-manager.ts dev\&quot;,\n    \&quot;typst:build\&quot;: \&quot;node scripts/typst-manager.ts build\&quot;,\n    \&quot;dev\&quot;: \&quot;concurrently \\\&quot;npm run typst:dev\\\&quot; \\\&quot;vite dev\\\&quot;\&quot;,\n    \&quot;build\&quot;: \&quot;npm run typst:build &amp;&amp; vite build\&quot;,\n    ...\n  },\n  ...\n}&quot;"></raw-copy-button><pre><code data-lang="json"><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">  </span><span style="color: #ffffff">.</span><span style="color: #ffffff">.</span><span style="color: #ffffff">.</span><br><span style="color: #abb2bf">  </span><span style="color: #9acc76">"</span><span style="color: #9acc76">scripts</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">    </span><span style="color: #9acc76">"</span><span style="color: #9acc76">typst:dev</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">node scripts/typst-manager.ts dev</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">    </span><span style="color: #9acc76">"</span><span style="color: #9acc76">typst:build</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">node scripts/typst-manager.ts build</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">    </span><span style="color: #9acc76">"</span><span style="color: #9acc76">dev</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">concurrently </span><span style="color: #5ebfcc">\"</span><span style="color: #9acc76">npm run typst:dev</span><span style="color: #5ebfcc">\"</span><span style="color: #9acc76"> </span><span style="color: #5ebfcc">\"</span><span style="color: #9acc76">vite dev</span><span style="color: #5ebfcc">\"</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">    </span><span style="color: #9acc76">"</span><span style="color: #9acc76">build</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">npm run typst:build &amp;&amp; vite build</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">    </span><span style="color: #ffffff">.</span><span style="color: #ffffff">.</span><span style="color: #ffffff">.</span><br><span style="color: #abb2bf">  </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">  </span><span style="color: #ffffff">.</span><span style="color: #ffffff">.</span><span style="color: #ffffff">.</span><br><span style="color: #abb2bf">}</span></code></pre></div></file-display>
    <p>Now, if you run <code><span style="color: #abb2bf">npm run dev</span></code>, any changes to <code><span style="color: #abb2bf">test.typ</span></code> should be reflected in <code><span style="color: #abb2bf">test.html</span></code> on save.</p>
    <h3>Hot reloading</h3>
    <p>Even though our HTML files change in sync with our Typst files, we have to manually reload our blog in <code><span style="color: #abb2bf">dev</span></code> mode if we want to see how those changes will look on our website. Let’s fix that!</p>
    <p>In <code><span style="color: #abb2bf">vite.config.ts</span></code>, we’ll create a new custom plugin that notifies the frontend whenever HTML files change. Replace</p>
    <file-display path="&quot;vite.config.ts&quot;"><div class="raw"><raw-copy-button text="&quot;export default defineConfig({\n\tplugins: [sveltekit()]\n});&quot;"></raw-copy-button><pre><code data-lang="ts"><span style="color: #cd74e8">export</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">default</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">defineConfig</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">  </span><span style="color: #abb2bf">plugins</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">[</span><span style="color: #5cb3fa">sveltekit</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">]</span><br><span style="color: #abb2bf">}</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span></code></pre></div></file-display>
    <p>with</p>
    <file-display path="&quot;vite.config.ts&quot;"><div class="raw"><raw-copy-button text="&quot;export default defineConfig({\n  plugins: [\n    sveltekit(),\n    {\n      name: \&quot;watch-content\&quot;,\n      handleHotUpdate({ file, server }) {\n        if (file.endsWith(\&quot;.html\&quot;)) {\n          server.ws.send({ type: \&quot;custom\&quot;, event: \&quot;content-update\&quot; });\n        }\n      },\n    },\n  ],\n});&quot;"></raw-copy-button><pre><code data-lang="ts"><span style="color: #cd74e8">export</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">default</span><span style="color: #abb2bf"> </span><span style="color: #5cb3fa">defineConfig</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">  </span><span style="color: #abb2bf">plugins</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">[</span><br><span style="color: #abb2bf">    </span><span style="color: #5cb3fa">sveltekit</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">      </span><span style="color: #abb2bf">name</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">watch-content</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">      </span><span style="color: #5cb3fa">handleHotUpdate</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">{</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">file</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">server</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">        </span><span style="color: #cd74e8">if</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">(</span><span style="color: #eb6772">file</span><span style="color: #abb2bf">.</span><span style="color: #5cb3fa">endsWith</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">"</span><span style="color: #9acc76">.html</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">          </span><span style="color: #eb6772">server</span><span style="color: #abb2bf">.</span><span style="color: #eb6772">ws</span><span style="color: #abb2bf">.</span><span style="color: #5ebfcc">send</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">{</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">type</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">custom</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">event</span><span style="color: #abb2bf">:</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">content-update</span><span style="color: #9acc76">"</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">        </span><span style="color: #abb2bf">}</span><br><span style="color: #abb2bf">      </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">    </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">  </span><span style="color: #abb2bf">]</span><span style="color: #abb2bf">,</span><br><span style="color: #abb2bf">}</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span></code></pre></div></file-display>
    <p>We can listen for these changes on the frontend by modifying <code><span style="color: #abb2bf">src/routes/+layout.svelte</span></code>. Add the following snippet to the <code><span style="color: #abb2bf">script</span></code> section of your <code><span style="color: #abb2bf">+layout.svelte</span></code> file:</p>
    <file-display path="&quot;src/routes/+layout.svelte&quot;"><div class="raw"><raw-copy-button text="&quot;import { invalidateAll } from \&quot;$app/navigation\&quot;;\nif (import.meta.hot) {\n   import.meta.hot.on(\&quot;content-update\&quot;, () => {\n     invalidateAll();\n   });\n}&quot;"></raw-copy-button><pre><code data-lang="ts"><span style="color: #cd74e8">import</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><span style="color: #abb2bf"> </span><span style="color: #eb6772">invalidateAll</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">from</span><span style="color: #abb2bf"> </span><span style="color: #9acc76">"</span><span style="color: #9acc76">$app/navigation</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">;</span><br><span style="color: #cd74e8">if</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">(</span><span style="color: #cd74e8">import</span><span style="color: #abb2bf">.</span><span style="color: #abb2bf">meta</span><span style="color: #abb2bf">.</span><span style="color: #eb6772">hot</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">   </span><span style="color: #cd74e8">import</span><span style="color: #abb2bf">.</span><span style="color: #abb2bf">meta</span><span style="color: #abb2bf">.</span><span style="color: #eb6772">hot</span><span style="color: #abb2bf">.</span><span style="color: #5cb3fa">on</span><span style="color: #abb2bf">(</span><span style="color: #9acc76">"</span><span style="color: #9acc76">content-update</span><span style="color: #9acc76">"</span><span style="color: #abb2bf">,</span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf"> </span><span style="color: #cd74e8">=></span><span style="color: #abb2bf"> </span><span style="color: #abb2bf">{</span><br><span style="color: #abb2bf">     </span><span style="color: #5cb3fa">invalidateAll</span><span style="color: #abb2bf">(</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">   </span><span style="color: #abb2bf">}</span><span style="color: #abb2bf">)</span><span style="color: #abb2bf">;</span><br><span style="color: #abb2bf">}</span></code></pre></div></file-display>
    <p>Now, when you’re running <code><span style="color: #abb2bf">npm run dev</span></code>, any changes to <code><span style="color: #abb2bf">test.typ</span></code> should be reflected in your browser on save!</p>
    <h2>Math</h2>
    <p>Clever observers might have noticed that Typst has been furiously emitting warnings about our use of math blocks in our <code><span style="color: #abb2bf">test.typ</span></code> file. Even cleverer observers might have noticed that our output HTML currently contains no math—Typst currently removes math elements because it doesn’t know how to display them. Let’s fix this!</p>
    <p>In the article function, we’ll create a show rule that changes the way Typst renders math equations:</p>
    <file-display path="&quot;src/posts/lib/lib.typ&quot;"><div class="raw"><raw-copy-button text="&quot;#let article(\n  // ...\n) = context {\n  show math.equation: it => {\n    show: if it.block {\n      it => html.elem(\&quot;div\&quot;, attrs: (class: \&quot;math\&quot;), it)\n    } else {\n      it => html.elem(\&quot;span\&quot;, attrs: (class: \&quot;math\&quot;), it)\n    }\n    html.frame(it)\n  }\n  // ...\n}&quot;"></raw-copy-button><pre><code data-lang="typ"><span style="color: #cd74e8">#</span><span style="color: #cd74e8">let</span> <span style="color: #5cb3fa">article</span>(<br>  <em><span style="color: #5f697a">// ...</span></em><br>) <span style="color: #adb7c9">=</span> <span style="color: #cd74e8">context</span> {<br>  <span style="color: #cd74e8">show</span> math.<span style="color: #5cb3fa">equation</span>: it <span style="color: #adb7c9">=></span> {<br>    <span style="color: #cd74e8">show</span>: <span style="color: #cd74e8">if</span> it.block {<br>      it <span style="color: #adb7c9">=></span> html.<span style="color: #5cb3fa">elem</span>(<span style="color: #9acc76">"div"</span>, attrs: (class: <span style="color: #9acc76">"math"</span>), it)<br>    } <span style="color: #cd74e8">else</span> {<br>      it <span style="color: #adb7c9">=></span> html.<span style="color: #5cb3fa">elem</span>(<span style="color: #9acc76">"span"</span>, attrs: (class: <span style="color: #9acc76">"math"</span>), it)<br>    }<br>    html.<span style="color: #5cb3fa">frame</span>(it)<br>  }<br>  <em><span style="color: #5f697a">// ...</span></em><br>}</code></pre></div></file-display>
    <p>Our show rule maps block math in <code><span style="color: #abb2bf">div</span></code>s and inline math in <code><span style="color: #abb2bf">span</span></code>s. Most importantly, it wraps the whole element in a <code><span style="color: #abb2bf">frame</span></code>, which makes Typst render the contained content as an SVG. Typst doesn’t currently have built-in HTML rendering for math, but it can render any part of the document as SVG, so we just wrap all our math equations with <code><span style="color: #abb2bf">frame</span></code>s to show them as SVGs instead.<sup><a id="footnote-return-4" href="#footnote-4" role="doc-noteref" aria-label="footnote 4">4</a></sup></p>
    <p>Now, math displays correctly!</p>
    <enhanced-img src="&quot;sveltekit-typst-blog/math.png&quot;" alt="&quot;Screenshot of rendered blog post, with math section containing inline and block equations.&quot;"></enhanced-img>
    <h2>Footnotes</h2>
    <p>Let’s add support for footnotes!<sup><a id="footnote-return-5" href="#footnote-5" role="doc-noteref" aria-label="footnote 5">5</a></sup> We want numbered superscripts that link to numbered footnotes at the bottom of the article which all also have backlinks. First, create another show rule:</p>
    <file-display path="&quot;src/posts/lib/lib.typ&quot;"><div class="raw"><raw-copy-button text="&quot;#let article(\n  // ...\n) = context {\n  show footnote: it => {\n    let count = counter(footnote).display()\n    super([#{\n        show html.elem.where(tag: \&quot;a\&quot;): it => {\n          if it.attrs.at(\&quot;role\&quot;, default: none) == none {\n            html.elem(\&quot;a\&quot;, attrs: (..it.attrs, role: \&quot;doc-noteref\&quot;, aria-label: \&quot;footnote \&quot; + count), it.body)\n          } else {\n            it\n          }\n        }\n        link(label(\&quot;footnote-\&quot; + count), count)\n      } #label(\&quot;footnote-return-\&quot; + count)])\n  }\n  // ...\n}&quot;"></raw-copy-button><pre><code data-lang="typ"><span style="color: #cd74e8">#</span><span style="color: #cd74e8">let</span> <span style="color: #5cb3fa">article</span>(<br>  <em><span style="color: #5f697a">// ...</span></em><br>) <span style="color: #adb7c9">=</span> <span style="color: #cd74e8">context</span> {<br>  <span style="color: #cd74e8">show</span> <span style="color: #5cb3fa">footnote</span>: it <span style="color: #adb7c9">=></span> {<br>    <span style="color: #cd74e8">let</span> count <span style="color: #adb7c9">=</span> <span style="color: #5cb3fa">counter</span>(footnote).<span style="color: #5cb3fa">display</span>()<br>    <span style="color: #5cb3fa">super</span>([#{<br>        <span style="color: #cd74e8">show</span> html.elem.<span style="color: #5cb3fa">where</span>(tag: <span style="color: #9acc76">"a"</span>): it <span style="color: #adb7c9">=></span> {<br>          <span style="color: #cd74e8">if</span> it.attrs.<span style="color: #5cb3fa">at</span>(<span style="color: #9acc76">"role"</span>, default: <span style="color: #cd74e8">none</span>) <span style="color: #adb7c9">==</span> <span style="color: #cd74e8">none</span> {<br>            html.<span style="color: #5cb3fa">elem</span>(<span style="color: #9acc76">"a"</span>, attrs: (<span style="color: #adb7c9">..</span>it.attrs, role: <span style="color: #9acc76">"doc-noteref"</span>, aria-label: <span style="color: #9acc76">"footnote "</span> <span style="color: #adb7c9">+</span> count), it.body)<br>          } <span style="color: #cd74e8">else</span> {<br>            it<br>          }<br>        }<br>        <span style="color: #5cb3fa">link</span>(<span style="color: #5cb3fa">label</span>(<span style="color: #9acc76">"footnote-"</span> <span style="color: #adb7c9">+</span> count), count)<br>      } <span style="color: #5cb3fa">#</span><span style="color: #5cb3fa">label</span>(<span style="color: #9acc76">"footnote-return-"</span> <span style="color: #adb7c9">+</span> count)])<br>  }<br>  <em><span style="color: #5f697a">// ...</span></em><br>}</code></pre></div></file-display>
    <p>This show rule uses Typst’s <code><span style="color: #abb2bf">counter</span></code> function to display numbered footnotes linked to their sources, and also sets up backlink targets so that readers can return to the article after reading the footnote. We use a show rule to add accessible attributes to the generated <code><span style="color: #abb2bf">a</span></code> element.</p>
    <p>Then, let’s update the <code><span style="color: #abb2bf">html.body</span></code> function to display each footnote, using Typst’s <code><span style="color: #abb2bf">query</span></code> function to find each footnote’s content.</p>
    <file-display path="&quot;src/posts/lib/lib.typ&quot;"><div class="raw"><raw-copy-button text="&quot;#html.elem(\&quot;body\&quot;)[\n  #content\n  #context {\n    let footnotes = query(footnote)\n    if footnotes.len() != 0 {\n      html.elem(\&quot;footer\&quot;)[\n        #html.elem(\&quot;ol\&quot;)[\n          #for (i, footnote) in footnotes.enumerate() {\n            let count = str(i + 1)\n            [#html.elem(\&quot;li\&quot;, attrs: (role: \&quot;doc-footnote\&quot;))[\n                #footnote.body #{\n                  show html.elem.where(tag: \&quot;a\&quot;): it => {\n                    if it.attrs.at(\&quot;role\&quot;, default: none) == none {\n                      html.elem(\n                        \&quot;a\&quot;,\n                        attrs: (\n                          ..it.attrs,\n                          role: \&quot;doc-backlink\&quot;,\n                          aria-label: \&quot;Back to content\&quot;,\n                        ),\n                        it.body,\n                      )\n                    } else {\n                      it\n                    }\n                  }\n                  link(label(\&quot;footnote-return-\&quot; + count))[↩︎]\n                }] #label(\&quot;footnote-\&quot; + count)]\n          }\n        ]\n      ]\n    }\n  }\n]&quot;"></raw-copy-button><pre><code data-lang="typ">#html.<span style="color: #5cb3fa">elem</span>(<span style="color: #9acc76">"body"</span>)[<br>  #content<br>  <span style="color: #cd74e8">#</span><span style="color: #cd74e8">context</span> {<br>    <span style="color: #cd74e8">let</span> footnotes <span style="color: #adb7c9">=</span> <span style="color: #5cb3fa">query</span>(footnote)<br>    <span style="color: #cd74e8">if</span> footnotes.<span style="color: #5cb3fa">len</span>() <span style="color: #adb7c9">!=</span> <span style="color: #db9d63">0</span> {<br>      html.<span style="color: #5cb3fa">elem</span>(<span style="color: #9acc76">"footer"</span>)[<br>        #html.<span style="color: #5cb3fa">elem</span>(<span style="color: #9acc76">"ol"</span>)[<br>          <span style="color: #cd74e8">#</span><span style="color: #cd74e8">for</span> (i, footnote) <span style="color: #cd74e8">in</span> footnotes.<span style="color: #5cb3fa">enumerate</span>() {<br>            <span style="color: #cd74e8">let</span> count <span style="color: #adb7c9">=</span> <span style="color: #5cb3fa">str</span>(i <span style="color: #adb7c9">+</span> <span style="color: #db9d63">1</span>)<br>            [#html.<span style="color: #5cb3fa">elem</span>(<span style="color: #9acc76">"li"</span>, attrs: (role: <span style="color: #9acc76">"doc-footnote"</span>))[<br>                #footnote.body #{<br>                  <span style="color: #cd74e8">show</span> html.elem.<span style="color: #5cb3fa">where</span>(tag: <span style="color: #9acc76">"a"</span>): it <span style="color: #adb7c9">=></span> {<br>                    <span style="color: #cd74e8">if</span> it.attrs.<span style="color: #5cb3fa">at</span>(<span style="color: #9acc76">"role"</span>, default: <span style="color: #cd74e8">none</span>) <span style="color: #adb7c9">==</span> <span style="color: #cd74e8">none</span> {<br>                      html.<span style="color: #5cb3fa">elem</span>(<br>                        <span style="color: #9acc76">"a"</span>,<br>                        attrs: (<br>                          <span style="color: #adb7c9">..</span>it.attrs,<br>                          role: <span style="color: #9acc76">"doc-backlink"</span>,<br>                          aria-label: <span style="color: #9acc76">"Back to content"</span>,<br>                        ),<br>                        it.body,<br>                      )<br>                    } <span style="color: #cd74e8">else</span> {<br>                      it<br>                    }<br>                  }<br>                  <span style="color: #5cb3fa">link</span>(<span style="color: #5cb3fa">label</span>(<span style="color: #9acc76">"footnote-return-"</span> <span style="color: #adb7c9">+</span> count))[↩︎]<br>                }] <span style="color: #5cb3fa">#</span><span style="color: #5cb3fa">label</span>(<span style="color: #9acc76">"footnote-"</span> <span style="color: #adb7c9">+</span> count)]<br>          }<br>        ]<br>      ]<br>    }<br>  }<br>]</code></pre></div></file-display>
    <p>Here, we create the targets for the links we set up in our show rule, and create backlinks with the <code><span style="color: #abb2bf">↩︎</span></code> symbol at the end of each footnote. We also use another show rule to add accessible attributes to our links.</p>
    <p>We can our implementation by modifying our <code><span style="color: #abb2bf">test.typ</span></code> file to include some example footnotes:</p>
    <file-display path="&quot;src/posts/test.typ&quot;"><div class="raw"><raw-copy-button text="&quot;// ...\n= Footnote\n\nLet's make footnotes#footnote[An example footnote]\nand more footnotes#footnote[\n  Another example footnote with *rich content*\n]&quot;"></raw-copy-button><pre><code data-lang="typ"><em><span style="color: #5f697a">// ...</span></em><br>= Footnote<br><br>Let's make footnotes<span style="color: #5cb3fa">#</span><span style="color: #5cb3fa">footnote</span>[An example footnote]<br>and more footnotes<span style="color: #5cb3fa">#</span><span style="color: #5cb3fa">footnote</span>[<br>  Another example footnote with <span style="color: #f0c678">*</span><span style="color: #f0c678">rich content</span><span style="color: #f0c678">*</span><br>]</code></pre></div></file-display>
    <p>Now, we have support for footnotes!</p>
    <enhanced-img src="&quot;sveltekit-typst-blog/footnote.png&quot;" alt="&quot;Screenshot of rendered blog post, with footnotes where clickable superscript links correspond to a numbered footnote list.&quot;"></enhanced-img>
    <h2>Conclusion</h2>
    <p>I hope this article provided a good guide for the basics of setting up a SvelteKit + Typst blog. Other features, like support for arbitrary figures or images that aren’t just embedded into the HTML can be implemented pretty easily with more show rules and some extra JavaScript. You can find the code <a href="https://github.com/Ashwagandhae/sveltekit-typst-blog">on Github</a>.</p>
    <p>The approach I used has good developer experience but is somewhat fragile; future solutions could use <a href="https://github.com/Myriad-Dreamin/typst.ts">typst.ts</a> to make a proper Vite plugin.</p>
    <footer>
      <ol>
        <li id="footnote-1" role="doc-footnote">
          <p>For example, if I wanted to list out the first 40 fibonacci numbers, which are 0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, 1597, 2584, 4181, 6765, 10946, 17711, 28657, 46368, 75025, 121393, 196418, 317811, 514229, 832040, 1346269, 2178309, 3524578, 5702887, 9227465, 14930352, 24157817, 39088169, and 63245986, I can do it by writing code like this:</p>
          <div class="raw">
            <raw-copy-button text="&quot;#let fibs(n) = {\n  let ret = (0, 1)\n  for _ in range(n - 2) {\n    ret = (..ret, ret.at(-1) + ret.at(-2))\n  }\n  ret\n}\nFor example, if I wanted to list out the first 40 fibonacci numbers,\nwhich are #fibs(40).map(str).join(\&quot;, \&quot;, last: \&quot;, and \&quot;), I can do it by\nwriting code like this:&quot;"></raw-copy-button>
            <pre><code data-lang="typ"><span style="color: #cd74e8">#</span><span style="color: #cd74e8">let</span> <span style="color: #5cb3fa">fibs</span>(n) <span style="color: #adb7c9">=</span> {<br>  <span style="color: #cd74e8">let</span> ret <span style="color: #adb7c9">=</span> (<span style="color: #db9d63">0</span>, <span style="color: #db9d63">1</span>)<br>  <span style="color: #cd74e8">for</span> _ <span style="color: #cd74e8">in</span> <span style="color: #5cb3fa">range</span>(n <span style="color: #adb7c9">-</span> <span style="color: #db9d63">2</span>) {<br>    ret <span style="color: #adb7c9">=</span> (<span style="color: #adb7c9">..</span>ret, ret.<span style="color: #5cb3fa">at</span>(<span style="color: #adb7c9">-</span><span style="color: #db9d63">1</span>) <span style="color: #adb7c9">+</span> ret.<span style="color: #5cb3fa">at</span>(<span style="color: #adb7c9">-</span><span style="color: #db9d63">2</span>))<br>  }<br>  ret<br>}<br>For example, if I wanted to list out the first 40 fibonacci numbers,<br>which are <span style="color: #5cb3fa">#</span><span style="color: #5cb3fa">fibs</span>(<span style="color: #db9d63">40</span>).<span style="color: #5cb3fa">map</span>(str).<span style="color: #5cb3fa">join</span>(<span style="color: #9acc76">", "</span>, last: <span style="color: #9acc76">", and "</span>), I can do it by<br>writing code like this:</code></pre>
          </div>
          <p><a href="#footnote-return-1" role="doc-backlink" aria-label="Back to content">↩︎</a></p>
        </li>
        <li id="footnote-2" role="doc-footnote">
          <p>You can also just run</p>
          <div class="raw">
            <raw-copy-button text="&quot;npx sv create --template minimal --types ts --install npm sveltkit-typst-blog&quot;"></raw-copy-button>
            <pre><code data-lang="bash"><span style="color: #eb6772">npx</span><span style="color: #abb2bf"> sv create</span><span style="color: #eb6772"> --</span><span style="color: #eb6772">template</span><span style="color: #abb2bf"> minimal</span><span style="color: #eb6772"> --</span><span style="color: #eb6772">types</span><span style="color: #abb2bf"> ts</span><span style="color: #eb6772"> --</span><span style="color: #eb6772">install</span><span style="color: #abb2bf"> npm sveltkit-typst-blog</span></code></pre>
          </div>
          <p>to skip manually selecting settings. <a href="#footnote-return-2" role="doc-backlink" aria-label="Back to content">↩︎</a></p>
        </li>
        <li id="footnote-3" role="doc-footnote">Typst automatically generates the basic <code><span style="color: #abb2bf">html</span></code>, <code><span style="color: #abb2bf">head</span></code> and <code><span style="color: #abb2bf">body</span></code> if you don’t create your own <code><span style="color: #abb2bf">html</span></code> element. However, we’re manually specifying the structure to give us more control over metadata. <a href="#footnote-return-3" role="doc-backlink" aria-label="Back to content">↩︎</a></li>
        <li id="footnote-4" role="doc-footnote">There are other approaches to rendering math, like using <a href="https://codeberg.org/akida/mathyml">mathyml</a> to convert equations to MathML Core or <a href="https://github.com/qwinsi/tex2typst">convert to LaTeX</a> and render with <a href="https://www.mathjax.org/">MathJax</a> or <a href="https://katex.org/">KaTeX</a>. I decided to use SVG rendering because of simplicity and visual accuracy. <a href="#footnote-return-4" role="doc-backlink" aria-label="Back to content">↩︎</a></li>
        <li id="footnote-5" role="doc-footnote">Typst already supports footnotes if you don’t override the default <code><span style="color: #abb2bf">html</span></code> and <code><span style="color: #abb2bf">body</span></code> element creation. Because we did override it, we have to implement footnotes manually. Manual implementation has the benefit of more customization, like allowing for backlinks. <a href="#footnote-return-5" role="doc-backlink" aria-label="Back to content">↩︎</a></li>
      </ol>
    </footer>
  </body>
</html>
